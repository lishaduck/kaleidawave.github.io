<!DOCTYPE html><html lang="en"><head><style>:where(img){height:auto}</style>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta content="pi8qBei6qHxHyGxm9Eh4WDhPwxU672uIJmfdIqcgIGs" name="google-site-verification">
    <meta content="no-referrer-when-downgrade" name="referrer">

    
    <!-- Cloudflare Web Analytics -->
    <script defer="defer" data-cf-beacon="{&quot;token&quot;: &quot;9a3f0b71c0ea4b3d99621e1b084c24cd&quot;}" src="https://static.cloudflareinsights.com/beacon.min.js"></script>
    <!-- End Cloudflare Web Analytics -->
    

    <title>JIT Hydration</title>

    <meta content="JIT Hydration" name="title">
    <meta content="JIT Hydration" property="og:title">
    <meta content="JIT Hydration" property="twitter:title">

    <meta content="JIT hydration is a technique for incrementally hydrating state from the HTML when building universally rendered sites" name="description">
    <meta content="JIT hydration is a technique for incrementally hydrating state from the HTML when building universally rendered sites" property="og:description">
    <meta content="JIT hydration is a technique for incrementally hydrating state from the HTML when building universally rendered sites" property="twitter:description">

    <meta content="website" property="og:type">
    <meta content="https://kaleidawave.github.io/" property="og:url">
    <meta content="summary_large_image" property="twitter:card">
    <meta content="https://kaleidawave.github.io/" property="twitter:url">

    
    <meta content="https://kaleidawave.github.io/media/banners/jit-hydration.png" property="twitter:image">
    <meta content="https://kaleidawave.github.io/media/banners/jit-hydration.png" property="og:image">
    

    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link rel="preconnect" href="https://fonts.gstatic.com"><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400&amp;family=Roboto+Serif&amp;family=Be+Vietnam+Pro:wght@600&amp;display=swap"><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400&amp;family=Roboto+Serif&amp;family=Be+Vietnam+Pro:wght@600&amp;display=swap">@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW86Rb0JcBaoUUU.woff2)format("woff2");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW87Rb0JcBaoUUU.woff2)format("woff2");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW81Rb0JcBao.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZJhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+460-52F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZthjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+301,U+400-45F,U+490-491,U+4B0-4B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZNhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+1F??}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZxhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+370-377,U+37A-37F,U+384-38A,U+38C,U+38E-3A1,U+3A3-3FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZBhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZFhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hjp-Ek-_EeA.woff)format("woff");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl618BtxaV4jcFyRM.woff)format("woff");unicode-range:U+460-52F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl6R8BtxaV4jcFyRM.woff)format("woff");unicode-range:U+301,U+400-45F,U+490-491,U+4B0-4B1,U+2116}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl698BtxaV4jcFyRM.woff)format("woff");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl658BtxaV4jcFyRM.woff)format("woff");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl6B8BtxaV4jcFw.woff)format("woff");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style>

    <style>:root{--text-color:#1a1a1a;--border:var(--text-color);--background:#f2f0eb;--muted-background:#f9f5f8;--muted-background-opaque:#f7f7f780;--accent:#bc3b3b;--muted-accent:#993b33;--code-highlight:#e2ccb7;font-family:SF Pro Display,SF Pro Icons,Inter,Helvetica Neue,Helvetica,Arial,sans-serif;font-weight:400}@media screen{:root.dark{--text-color:#dbdbdb;--background:#0f0f10;--muted-background:#1f1f23;--muted-background-opaque:#1f1f2380;--accent:#a8ff8e;--muted-accent:#81b47c;--code-highlight:#549463}}:root.dark .shiki-light,:root:not(.dark) .shiki-dark{display:none}html,body{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body{background-color:var(--background,white);color:var(--text-color,black);flex-direction:column;min-height:100vh;display:flex}header{background-color:var(--muted-background-opaque,white);justify-content:space-around;align-items:center;padding:14px;font-size:16px;display:flex}:root:not(.dark) header{border-bottom:2px solid var(--border)}header>div{justify-content:space-between;align-items:center;display:flex;width:100%!important}header video{position:absolute}header h1{color:var(--text-color);font-size:20px;font-weight:100}header h1>a{color:var(--text-color)!important}header .icon-title{align-items:center;gap:8px;display:flex}header img{width:auto;height:26px;position:relative;top:-4px}@media print{header nav,footer{display:none}}header nav>ul{padding-left:0;list-style:none;display:flex}header nav>ul>li{text-transform:lowercase;margin-left:10px}h1,h2,h3,h4,h5{scroll-margin:100px;font-family:Be Vietnam Pro,sans-serif;font-weight:600}::selection{background:var(--muted-accent);color:var(--background)}em{position:relative;left:-2px}ul,ol{margin:0;padding-left:20px}hr{border:none;border-top:1px solid var(--text-color);width:100%;margin:30px auto}main{margin:20px 0 80px}.width-box{width:95%;margin:0 auto}svg.icon{fill:var(--muted-accent);height:10pt;position:relative;top:2px}a{color:var(--accent,white);text-decoration:none}a:visited{color:var(--muted-accent,white)}pre code{tab-size:4;overflow-x:hidden;white-space:break-spaces!important}:is(div,p,a,li)>code,div>pre{border-radius:4px;font-size:15px}pre,code{font-family:JetBrains Mono,Fira Code light,consolas,monospace;background-color:var(--muted-background)!important}footer{background-color:var(--muted-background,white);margin-top:auto;padding:22px}:root:not(.dark) footer{border-top:2px solid var(--border)}footer>div{justify-content:space-between;align-items:center;display:flex}footer h3{font-weight:inherit;margin:0;font-size:16px}footer nav ul{flex-wrap:wrap;gap:6px;list-style:none;display:flex}footer nav ul>li:not(:first-child){border-left:2px solid var(--muted-accent);padding-left:6px}footer>div>:nth-child(2n){margin-left:auto;font-size:10pt}@media screen and (width<=480px){header>div{flex-direction:column}body{box-sizing:border-box;width:100vw}.posts>ul>li img{width:100%;height:auto}}@media screen and (width>=480px){@supports (backdrop-filter:blur(20px)){header{backdrop-filter:blur(20px)}}header{z-index:100;position:sticky;top:0;left:0;right:0}.width-box{width:100%;max-width:min(80vw,780px)}}</style>
</head>

<body>
    <header>
        <div class="width-box">
            <a href="/" class="icon-title">
                <h1 class="header-title">Ben's Engineering Blog</h1>
                <img alt decoding="async" height="256" src="/media/icon.png.webp" width="256" fetchpriority="high" draggable="true">
                
            </a>
            <nav>
                <ul>
                    <li><a href="/posts">Posts</a></li>
                    <li><a href="/about">About</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        
        <div class="width-box">
            <style>.post{flex-direction:column;display:flex}.post>p,.post li,.post blockquote{line-height:1.6em;font-weight:inherit;margin:6px 0;font-family:Inter,Helvetica,sans-serif}.post>:is(h1,h2,h3,h4,h5){margin:12pt 0}.post img,.post video,.post pre:not(.shiki){margin:20px 0}.post pre.shiki{margin:0}:root:not(.dark) .post img.invertible,:root:not(.dark) .post video.invertible{filter:invert()}.post img{border-radius:10px}.post svg.icon{fill:var(--text-color);height:1em}.post span.line.highlight{background-color:var(--code-highlight);outline:4px var(--code-highlight)solid;font-weight:700}.post .shiki-container{padding:20px}.post .math{margin:auto}.post .math>svg{width:auto;height:200%;margin:10px}.post .quote{font-style:italic}.post .quote:before,.post .quote:after{content:"\""}.post [role=caption]{text-align:center;opacity:.8;margin:6px 0 20px;padding:6px;font-size:14px;font-weight:400}.post .date{margin-top:0;font-family:monospace;font-size:11pt}.post .center{text-align:center;font-weight:inherit;padding:30px}.post .note{opacity:.8;font-size:12pt;font-style:italic}:is(h1,h2,h3,h4,h5,h6)>code{font-size:.8em}:is(h1,h2,h3,h4,h5,h6,p,li)>code{padding:2px 6px}.post a[href^=\#foot]{font-family:monospace;position:relative;top:-5px;left:2px}.post #footnotes~*{width:100%;margin:4px 0;font-size:14px}video.small{max-height:300px!important}.callout{background-color:var(--muted-background);border:3px solid var(--muted-accent);border-radius:16px;margin-top:18px;padding:20px;font-size:15pt}.post h1.title{font-size:48px}.post h1{font-size:32px}.post h2{font-size:28px}.post h3{font-size:24px}.post h4{font-size:20px}.post h5{font-size:16px}.post a.media-container>img{width:100%}blockquote{border-left:4px solid var(--muted-accent);margin:10px 0;padding:0 10px}blockquote>p{margin:0}.discussions{margin:80px 0}.parralel pre:not(.shiki){font-size:12px}@media screen and (width<=480px){.center{text-align:center;font-weight:inherit;padding:10px 0}.post>p,.post li{font-size:12pt;line-height:1.4em}.post img,.post pre,.post video{width:100%;height:auto}.post pre{overflow-x:auto}}@media screen and (width>=480px){.post>.parralel{gap:30px;display:flex}.post>.parralel>div{flex-grow:1}.post img,.post video,.post pre:not(.shiki){align-self:center;max-width:100vw;height:auto;max-height:100vh}.post>img,.post>video,.post>a.media-container,.post>.parralel,.post>pre:not(.shiki){align-self:center;width:110%}}@media print{.post video{display:none}}</style>

<div class="post">
    <h1 class="title">JIT Hydration</h1>
    
    <p class="date">
        Published on Tuesday 24<sup>th</sup> November 2020
        
    </p>
    
    <p>What is hydration? It typically refers to the act of making statically rendered markup interactive.</p>
<p>But what is interactive? Interactivity is added by attaching event listeners and setting the scene for those listeners to be able to change the view. The step aims to make the page indifferent to it being client-side rendered.</p>
<p>So how do frameworks add event listeners to the existing markup?</p>
<p>Many frameworks do this by rendering the markup again. The rendering identifies where the elements with listeners are. And from knowing their position they can attach to existing markup. To render the application first requires hydrating the state. For example with React:</p>
<img alt="react-hydration" decoding="async" height="157316" src="/media/react-hydration.gif" width="698" fetchpriority="high">
<p><em>(Something like that I think)</em></p>
<p>But the issue here is to add the event listeners the component needs to be <em>rendered</em> <strong>and for it to be rendered it needs to its data/state</strong>.</p>
<p>This is where hydration comes in. To render this "frame" it needs some data.</p>
<p>Standard client-side rendered sites would make a HTTP request to the backend API to get the data on the initial mount. But this is a separate request, there may have been changes to the data in the time between rendering the page, getting it to the client and the client parsing and running the script. The difference in the data could break things. The other issue is that this is a totally new request and (without backend caching) would have to make another request to the database which is expensive.</p>
<h4 id="double-data" tabindex="-1">So the solution a lot of frameworks use is to send the data down as a JSON blob with the request</h4>
<pre><code class="language-html" data-highlight="6,15"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#c9d1d9">&lt;</span><span style="color:#7ee787">head</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">        window.__data__ </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">JSON</span><span style="color:#c9d1d9">.</span><span style="color:#79c0ff">parse</span><span style="color:#c9d1d9">(</span><span style="color:#a5d6ff">`</span></span>
<span class="line"><span style="color:#a5d6ff">            {</span></span>
<span class="line"><span style="color:#a5d6ff">                "articles": [</span></span>
<span class="line"><span style="color:#a5d6ff">                    {</span></span>
<span class="line"><span style="color:#a5d6ff">                        "title": "Tips for performant TypeScript"</span></span>
<span class="line"><span style="color:#a5d6ff">                    }</span></span>
<span class="line"><span style="color:#a5d6ff">                ]</span></span>
<span class="line"><span style="color:#a5d6ff">            }</span></span>
<span class="line"><span style="color:#a5d6ff">        `</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;/</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">&lt;/</span><span style="color:#7ee787">head</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">&lt;</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9">&gt;Tips for performant TypeScript&lt;/</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">&lt;/</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">&lt;</span><span style="color:#116329">head</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">        window.__data__ </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">JSON</span><span style="color:#24292f">.</span><span style="color:#0550ae">parse</span><span style="color:#24292f">(</span><span style="color:#0a3069">`</span></span>
<span class="line"><span style="color:#0a3069">            {</span></span>
<span class="line"><span style="color:#0a3069">                "articles": [</span></span>
<span class="line"><span style="color:#0a3069">                    {</span></span>
<span class="line"><span style="color:#0a3069">                        "title": "Tips for performant TypeScript"</span></span>
<span class="line"><span style="color:#0a3069">                    }</span></span>
<span class="line"><span style="color:#0a3069">                ]</span></span>
<span class="line"><span style="color:#0a3069">            }</span></span>
<span class="line"><span style="color:#0a3069">        `</span><span style="color:#24292f">);</span></span>
<span class="line"><span style="color:#24292f">    &lt;/</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">&lt;/</span><span style="color:#116329">head</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">&lt;</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">h1</span><span style="color:#24292f">&gt;Tips for performant TypeScript&lt;/</span><span style="color:#116329">h1</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">&lt;/</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"></span></code></pre></div></code></pre>
<h5 id="this-has-some-overhead-because-the-data-is-effectively-sent-down-twice" tabindex="-1"><a href="https://youtu.be/CQaDl9Fu0W0?t=365">This has some overhead because the data is effectively sent down twice</a></h5>
<p>There is also the fact JSON is difficult to work with due to its difficulty in representing complex types such as <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"><code>Date</code></a> and other things like cyclic references etc. Also, some JSON blobs are quite large especially if there are long lists of objects. And using raw JS object literals can be slow <a href="https://www.youtube.com/watch?v=ff4fgQxPaO0">due to the way they are parsed</a>.</p>
<p>Additionally, some parts of this object were not used in the render and so will not be needed in the re-render. In a large number of cases, this object contains more data than was needed.</p>
<p>The 'Time to interactive' measurement can be decreased because the whole state has to be parsed evaluated and the application rendered before a single event listener has been added. This problem also occurs for static site generation as well. Any sort of process of generating markup beforehand (which is beneficial) where that markup needs client-side reactivity needs to do some sort of hydration.</p>
<p>This issue is something framework authors and developers are aware of and actively working on:</p>
<ul>
<li><a href="https://twitter.com/youyuxi/status/1274834284826763265">Evan You, Creator of Vue</a></li>
<li><a href="https://developers.google.com/web/updates/2019/02/rendering-on-the-web#rehydration-issues">Google post on the issue</a></li>
</ul>
<p><a href="https://medium.com/@luke_schmuke/how-we-achieved-the-best-web-performance-with-partial-hydration-20fab9c808d5#94ad">Partial hydration</a> is one technique that is being considered. Using partial hydration in an app you split up the application so there are multiple sources. Instead of a single <code>hydrate</code> call, there are multiple invocations under some components. This way you can prioritize reactive elements and ignore static elements. See popular RFCs from these frameworks; <a href="https://github.com/sveltejs/svelte/issues/4308">Svelte</a>, <a href="https://github.com/facebook/react/pull/14717">react</a>, <a href="https://github.com/angular/angular/issues/13446">angular</a>.</p>
<p>But most implementations seem quite manual to implement. It also seems difficult to how this plays out with what is a static element and what needs to be reactive.</p>
<h3 id="jit-hydration" tabindex="-1">But today I'll introduce a different approach: JIT hydration</h3>
<p>The fastest interactivity would be prioritizing adding event listeners. A non VDOM system doesn't need state to find event listeners. Instead, the framework's compiler could mark elements with event listeners and these could be added with the combination of local state in custom elements and <code>this.querySelector("#element_identifier").addEventListener</code>.</p>
<p>The state still needs to be hydrated to be accessible at the JS runtime. <strong>But to prevent the double data problem the values would be hydrated from the rendered DOM and they could be done on access just in time (JIT)</strong>.</p>
<p>This is what I have implemented into my framework <a href="https://github.com/kaleidawave/prism">Prism</a>. One of the features is JIT hydration:</p>
<img alt="prism-hydration" decoding="async" height="213000" src="/media/prism-hydration.gif" width="700" loading="lazy">
<h4 id="demo" tabindex="-1">And this is working quite well here on my <a href="https://github.com/kaleidawave/hackernews-prism">Hacker News clone</a></h4>
<img alt="hackernews-prism-hydration" decoding="async" height="151200" src="/media/hackernews-prism-hydration.gif" width="1280" loading="lazy">
<p>It is compiled with the Prism compiler and all the rendered data can be JIT hydrated while none of the payloads send any sort of JS(ON) state blobs.</p>
<p>You can read more about the Hacker News clone <a href="/posts/hackernews-clone-prism-rust">here</a></p>
<p>JIT hydration has the effect of a fully hydrated page but at a lower cost to the client.</p>
<h3 id="benefits" tabindex="-1">So what are the features and benefits of Prism's JIT hydration?</h3>
<ul>
<li>On load, the only logic is attaching event listeners. This leads to a decrease in the 'time-to-interactive' (TTI)</li>
<li>Loading state is deferred until needed</li>
<li>Loading in state is done on a per-property basis rather than everything at once so the lazy-ness does not come at a significant cost</li>
<li>Smaller HTML payload sizes due to not needing JSON state</li>
<li>Resolved complications for objects that cannot be represented in JSON (looking at you <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"><code>Date</code></a> 👀), cycles etc</li>
</ul>
<p>Although values in the DOM are all strings, Prism converts the strings to the correct types. As can be seen from the&nbsp;<code>id</code>&nbsp;and&nbsp;<code>score</code>&nbsp;values on each story in the state. Values are also cached after being pulled in during hydration, so later accessors don't have to go back to the DOM. The logic for doing this is invariant to the page and so JS is cached between requests. The JSON blob is different and so is sent down on every new full page.</p>
<div class="parralel">
            <div><h3 id="json-based-hydration" tabindex="-1">JSON based hydration</h3>
<pre><code class="language-html"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#c9d1d9">&lt;</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">class</span><span style="color:#c9d1d9">=</span><span style="color:#a5d6ff">"title"</span><span style="color:#c9d1d9">&gt;*post title*&lt;/</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">id</span><span style="color:#c9d1d9">=</span><span style="color:#a5d6ff">"data"</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">type</span><span style="color:#c9d1d9">=</span><span style="color:#a5d6ff">"application/json"</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">        {..., "title": "*post title*", ...}</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;/</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">        </span><span style="color:#ff7b72">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">data</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span></span>
<span class="line"><span style="color:#c9d1d9">            document.</span><span style="color:#d2a8ff">getElementById</span><span style="color:#c9d1d9">(</span><span style="color:#a5d6ff">'data'</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#c9d1d9">        </span><span style="color:#ff7b72">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">state</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span></span>
<span class="line"><span style="color:#c9d1d9">            </span><span style="color:#79c0ff">JSON</span><span style="color:#c9d1d9">.</span><span style="color:#79c0ff">parse</span><span style="color:#c9d1d9">(data.textContent);</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;/</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">&lt;/</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">&lt;</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">h1</span><span style="color:#24292f"> </span><span style="color:#0550ae">class</span><span style="color:#24292f">=</span><span style="color:#0a3069">"title"</span><span style="color:#24292f">&gt;*post title*&lt;/</span><span style="color:#116329">h1</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">script</span><span style="color:#24292f"> </span><span style="color:#0550ae">id</span><span style="color:#24292f">=</span><span style="color:#0a3069">"data"</span><span style="color:#24292f"> </span><span style="color:#0550ae">type</span><span style="color:#24292f">=</span><span style="color:#0a3069">"application/json"</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">        {..., "title": "*post title*", ...}</span></span>
<span class="line"><span style="color:#24292f">    &lt;/</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">const</span><span style="color:#24292f"> </span><span style="color:#0550ae">data</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span></span>
<span class="line"><span style="color:#24292f">            document.</span><span style="color:#8250df">getElementById</span><span style="color:#24292f">(</span><span style="color:#0a3069">'data'</span><span style="color:#24292f">);</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">const</span><span style="color:#24292f"> </span><span style="color:#0550ae">state</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span></span>
<span class="line"><span style="color:#24292f">            </span><span style="color:#0550ae">JSON</span><span style="color:#24292f">.</span><span style="color:#0550ae">parse</span><span style="color:#24292f">(data.textContent);</span></span>
<span class="line"><span style="color:#24292f">    &lt;/</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">&lt;/</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"></span></code></pre></div></code></pre>
<blockquote>
<p>Data twice in response, parse done after load</p>
</blockquote>
</div>
            <div>
<h3 id="with-prism-compiler" tabindex="-1">With Prism compiler</h3>
<pre><code class="language-html"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#c9d1d9">&lt;</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">class</span><span style="color:#c9d1d9">=</span><span style="color:#a5d6ff">"title"</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">id</span><span style="color:#c9d1d9">=</span><span style="color:#a5d6ff">"p2312"</span><span style="color:#c9d1d9">&gt;*post title*&lt;/</span><span style="color:#7ee787">h1</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">    ...</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">        </span><span style="color:#ff7b72">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">state</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> {</span></span>
<span class="line"><span style="color:#c9d1d9">            </span><span style="color:#ff7b72">get</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">title</span><span style="color:#c9d1d9">() {</span></span>
<span class="line"><span style="color:#c9d1d9">                </span><span style="color:#ff7b72">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">element</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span></span>
<span class="line"><span style="color:#c9d1d9">                    document.</span><span style="color:#d2a8ff">querySelector</span><span style="color:#c9d1d9">(</span><span style="color:#a5d6ff">"p2312"</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#c9d1d9">                </span><span style="color:#ff7b72">return</span><span style="color:#c9d1d9"> element.innerText;</span></span>
<span class="line"><span style="color:#c9d1d9">            }</span></span>
<span class="line"><span style="color:#c9d1d9">        }</span></span>
<span class="line"><span style="color:#c9d1d9">    &lt;/</span><span style="color:#7ee787">script</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"><span style="color:#c9d1d9">&lt;/</span><span style="color:#7ee787">body</span><span style="color:#c9d1d9">&gt;</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">&lt;</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">h1</span><span style="color:#24292f"> </span><span style="color:#0550ae">class</span><span style="color:#24292f">=</span><span style="color:#0a3069">"title"</span><span style="color:#24292f"> </span><span style="color:#0550ae">id</span><span style="color:#24292f">=</span><span style="color:#0a3069">"p2312"</span><span style="color:#24292f">&gt;*post title*&lt;/</span><span style="color:#116329">h1</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">    ...</span></span>
<span class="line"><span style="color:#24292f">    &lt;</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">        </span><span style="color:#cf222e">const</span><span style="color:#24292f"> </span><span style="color:#0550ae">state</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> {</span></span>
<span class="line"><span style="color:#24292f">            </span><span style="color:#cf222e">get</span><span style="color:#24292f"> </span><span style="color:#8250df">title</span><span style="color:#24292f">() {</span></span>
<span class="line"><span style="color:#24292f">                </span><span style="color:#cf222e">const</span><span style="color:#24292f"> </span><span style="color:#0550ae">element</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span></span>
<span class="line"><span style="color:#24292f">                    document.</span><span style="color:#8250df">querySelector</span><span style="color:#24292f">(</span><span style="color:#0a3069">"p2312"</span><span style="color:#24292f">);</span></span>
<span class="line"><span style="color:#24292f">                </span><span style="color:#cf222e">return</span><span style="color:#24292f"> element.innerText;</span></span>
<span class="line"><span style="color:#24292f">            }</span></span>
<span class="line"><span style="color:#24292f">        }</span></span>
<span class="line"><span style="color:#24292f">    &lt;/</span><span style="color:#116329">script</span><span style="color:#24292f">&gt;</span></span>
<span class="line"><span style="color:#24292f">&lt;/</span><span style="color:#116329">body</span><span style="color:#24292f">&gt;</span></span>
<span class="line"></span></code></pre></div></code></pre>
<blockquote>
<p>Data loaded from markup and only when requested</p>
</blockquote>
</div>
        </div>
<h3 id="conclusion" tabindex="-1">Conclusion</h3>
<p>While it has its benefits, JIT hydration is difficult to implement. For it to work effectively there needs to be more analysis and code generation work done at build time. It needs to be established where the state is interpolated and how that can be reversed to be read at runtime.</p>
<p>There are also complications as components now have a <em>virtualized</em> or computed state. Another fact is that child components can have the state before the parent does. To do the immediate event listeners addition without state there needs to be markers in the markup as where elements are. Prism does this with a combination of classes added at build time and custom elements. Using these markers alleviates the need to "render" the whole application.</p>
<p>There are also complexities around values that are not represented literally in the DOM. For example, the <code>href</code> on the link tags is interpreted as <code>/i/${id}</code>. Prism has a limited expression reversal and here creates a <code>slice</code> expression to get the <code>id</code> value. But for more complex expressions it breaks down, especially for not 1:1 expressions where it is impossible.</p>
<p>So yeah, this is super early and experimental stuff. If you have any questions or feedback it would be great to leave them in the comments.</p>
<p>You can follow me and the development of Prism <a href="https://twitter.com/kaleidawave">@kaleidawave</a></p>

</div>

<div class="discussions">
    <script src="https://giscus.app/client.js" async crossorigin="anonymous" data-category="Comments" data-category-id="DIC_kwDOIy08KM4CTpn8" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-loading="lazy" data-mapping="pathname" data-reactions-enabled="1" data-repo="kaleidawave/discussions" data-repo-id="R_kgDOIy08KA" data-strict="0" data-theme="preferred_color_scheme">
            </script>
</div>

<script defer="defer">for(let video of document.querySelectorAll("video"))video.addEventListener("mouseover",e=>{e.target.play()});</script>

        </div>
        
    </main>
    <footer>
        <div class="width-box">
            <form>
                <label for="toggle-theme">Light Mode</label>
                <input id="toggle-theme" name="toggle-theme" type="checkbox">
            </form>
            <nav>
                <ul>
                    <li>
                        <a href="https://twitter.com/kaleidawave">Twitter <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter icon</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a>
                    </li>
                    <li>
                        <a href="https://github.com/kaleidawave">GitHub <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                    </li>
                    <li>
                        Built with <a href="https://www.11ty.dev/"><svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Eleventy icon</title><path d="M3.398 12V0h17.204v24H3.398zm13.17 6.07a1.07 1.07 0 00.373-.107c.432-.213.68-.672.877-1.626.076-.372 1.195-6.168 1.209-6.263.026-.186-.008-.382-.084-.476a.325.325 0 00-.087-.064l-.06-.031h-.291c-.253 0-.298 0-.348.02-.113.039-.207.156-.255.316-.011.038-.168.881-.348 1.873l-.328 1.802-.046-.21c-.56-2.547-.764-3.452-.794-3.532a.383.383 0 00-.103-.16c-.105-.107-.117-.11-.567-.11-.411 0-.422 0-.5.074-.086.079-.122.216-.111.42.006.115.045.27.688 2.784.663 2.587.751 2.943.787 3.177.046.3-.05.713-.208.893-.032.037-.037.039-.084.032-.028 0-.12-.027-.204-.051-.268-.078-.362-.072-.462.028-.096.096-.137.248-.138.51 0 .256.028.34.159.473.131.133.324.208.595.23.164.012.22.012.33-.001zm-1.896-1.712a.31.31 0 00.16-.192c.02-.058.022-.098.022-.356 0-.255-.003-.299-.021-.354-.04-.121-.136-.196-.278-.217-.041-.01-.2-.01-.355-.01-.365-.001-.378-.01-.446-.184-.068-.18-.096-.326-.113-.602a85.799 85.799 0 01-.012-1.94v-1.765h.35c.454 0 .507-.01.602-.113a.465.465 0 00.102-.24 3.273 3.273 0 000-.534c-.026-.16-.099-.271-.211-.322-.057-.025-.065-.026-.45-.03h-.392l-.003-1.22c-.003-1.09-.005-1.227-.021-1.278a.378.378 0 00-.201-.247c-.052-.024-.072-.025-.32-.029-.27 0-.356 0-.429.038-.087.042-.148.133-.185.278-.014.054-.032.346-.076 1.262l-.06 1.194s-.08 0-.18.01c-.206.01-.263.022-.327.086-.092.092-.12.19-.127.455-.01.334.02.487.115.588.075.081.134.1.345.106l.173.01v1.785c0 1.7.006 2.019.034 2.274.041.37.13.709.241.928.194.38.544.617.988.668h1.005l.07-.04zm-7.447 0c.098-.053.16-.154.2-.332.016-.077.018-.401.018-4.518 0-4.184-.001-4.44-.02-4.51-.05-.194-.19-.29-.378-.26-.035.01-.344.084-.686.175-.343.09-.684.18-.758.198-.17.043-.214.062-.281.126-.105.098-.122.185-.122.606 0 .416.016.5.12.604.094.095.189.1.456.03.103-.026.193-.048.2-.048.01 0 .014.784.017 3.763.003 3.436.005 3.77.021 3.84.048.202.113.296.236.34.034.013.133.016.487.014.435 0 .445 0 .49-.027zm3.203 0c.092-.046.152-.135.197-.29l.024-.084.003-4.435c.002-3.194 0-4.456-.01-4.509-.033-.2-.145-.308-.322-.308-.066 0-.198.03-.857.204-.56.147-.799.214-.849.239a.34.34 0 00-.17.184c-.024.06-.024.071-.024.479 0 .415 0 .417.026.483a.362.362 0 00.083.12c.1.1.172.105.456.034a5.46 5.46 0 01.208-.05c.008 0 .012 1.202.014 3.791l.003 3.79.026.086a.48.48 0 00.135.23c.078.062.085.063.57.06.414 0 .447 0 .487-.024z"/></svg> Eleventy</a> and
                        <a href="/architecture">others</a>
                    </li>
                </ul>
            </nav>
        </div>
    </footer>
    <script>function changeScheme(e=null){null===e&&(e="matchMedia"in window&&window.matchMedia("(prefers-color-scheme: dark)").matches),localStorage.setItem("theme",e?"dark":"light"),updateThemeClass()}function updateThemeClass(e=null){null===e&&(e="dark"===localStorage.getItem("theme")),e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}null===localStorage.getItem("theme")?changeScheme():updateThemeClass();{let e=document.querySelector("#toggle-theme");e.checked="dark"!==localStorage.getItem("theme"),e.addEventListener("change",e=>{changeScheme(!e.target.checked)})}document.addEventListener("click",e=>{if(e.target.matches(".post > *:is(h2, h3, h4, h5)")){let t=e.target.getAttribute("id");null!==t&&(location.href="#"+t)}});let titleBar=document.querySelector("header .icon-title");for(let element of(console.log(titleBar.querySelector("img")),titleBar.querySelector("img").addEventListener("dragend",()=>{let e=document.createElement("video"),t=document.createElement("source");t.src="/media/boom.webm",e.append(t),e.controls=!1,titleBar.appendChild(e),e.addEventListener("ended",()=>{titleBar.querySelector(".header-title").innerText="Bengineering",e.style.display="none"}),e.play()}),document.querySelectorAll("[data-highlight]"))){let e=element.getAttribute("data-highlight").split(",").map(e=>parseInt(e));for(let t of element.children[0].children)for(let l of e){let e=t.children[0].children[l],n=e.children[0],a=n.textContent.trimLeft(),r=n.textContent.length-a.length;n.childNodes[0].data=a,e.style.marginLeft=r+"ch",e.classList.add("highlight")}}</script>


</body></html>