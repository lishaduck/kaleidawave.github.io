<!DOCTYPE html><html lang="en"><head><style>:where(img){height:auto}</style>
    <meta charset="utf-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <meta content="pi8qBei6qHxHyGxm9Eh4WDhPwxU672uIJmfdIqcgIGs" name="google-site-verification">
    <meta content="no-referrer-when-downgrade" name="referrer">

    
    <!-- Cloudflare Web Analytics -->
    <script defer="defer" data-cf-beacon="{&quot;token&quot;: &quot;9a3f0b71c0ea4b3d99621e1b084c24cd&quot;}" src="https://static.cloudflareinsights.com/beacon.min.js"></script>
    <!-- End Cloudflare Web Analytics -->
    

    <title>Ezno in '23</title>

    <meta content="Ezno in '23" name="title">
    <meta content="Ezno in '23" property="og:title">
    <meta content="Ezno in '23" property="twitter:title">

    <meta content="Where is Ezno? What's next?" name="description">
    <meta content="Where is Ezno? What's next?" property="og:description">
    <meta content="Where is Ezno? What's next?" property="twitter:description">

    <meta content="website" property="og:type">
    <meta content="https://kaleidawave.github.io/" property="og:url">
    <meta content="summary_large_image" property="twitter:card">
    <meta content="https://kaleidawave.github.io/" property="twitter:url">

    
    <meta content="https://kaleidawave.github.io/media/banners/ezno-2023.png" property="twitter:image">
    <meta content="https://kaleidawave.github.io/media/banners/ezno-2023.png" property="og:image">
    

    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link rel="preconnect" href="https://fonts.gstatic.com"><link rel="stylesheet" data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400&amp;family=Roboto+Serif&amp;family=Be+Vietnam+Pro:wght@600&amp;display=swap"><style data-href="https://fonts.googleapis.com/css2?family=Inter:wght@400&amp;family=Roboto+Serif&amp;family=Be+Vietnam+Pro:wght@600&amp;display=swap">@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW86Rb0JcBaoUUU.woff2)format("woff2");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW87Rb0JcBaoUUU.woff2)format("woff2");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Be Vietnam Pro;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/bevietnampro/v11/QdVMSTAyLFyeg_IDWvOJmVES_HToIW81Rb0JcBao.woff2)format("woff2");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZJhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+460-52F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZthjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+301,U+400-45F,U+490-491,U+4B0-4B1,U+2116}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZNhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+1F??}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZxhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+370-377,U+37A-37F,U+384-38A,U+38C,U+38E-3A1,U+3A3-3FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZBhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZFhjp-Ek-_EeAmM.woff)format("woff");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Inter;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hjp-Ek-_EeA.woff)format("woff");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl618BtxaV4jcFyRM.woff)format("woff");unicode-range:U+460-52F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl6R8BtxaV4jcFyRM.woff)format("woff");unicode-range:U+301,U+400-45F,U+490-491,U+4B0-4B1,U+2116}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl698BtxaV4jcFyRM.woff)format("woff");unicode-range:U+102-103,U+110-111,U+128-129,U+168-169,U+1A0-1A1,U+1AF-1B0,U+300-301,U+303-304,U+308-309,U+323,U+329,U+1EA0-1EF9,U+20AB}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl658BtxaV4jcFyRM.woff)format("woff");unicode-range:U+100-2AF,U+304,U+308,U+329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Roboto Serif;font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(https://fonts.gstatic.com/s/robotoserif/v13/R71RjywflP6FLr3gZx7K8UyuXDs9zVwDmXCb8lxYgmuii32UGoVldX6UgfjL4-3sMM_kB_qXSEXTJQCFLH5-_bcEliotl6B8BtxaV4jcFw.woff)format("woff");unicode-range:U+??,U+131,U+152-153,U+2BB-2BC,U+2C6,U+2DA,U+2DC,U+304,U+308,U+329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}</style>

    <style>:root{--text-color:#1a1a1a;--border:var(--text-color);--background:#f2f0eb;--muted-background:#f9f5f8;--muted-background-opaque:#f7f7f780;--accent:#bc3b3b;--muted-accent:#993b33;--code-highlight:#e2ccb7;font-family:SF Pro Display,SF Pro Icons,Inter,Helvetica Neue,Helvetica,Arial,sans-serif;font-weight:400}@media screen{:root.dark{--text-color:#dbdbdb;--background:#0f0f10;--muted-background:#1f1f23;--muted-background-opaque:#1f1f2380;--accent:#a8ff8e;--muted-accent:#81b47c;--code-highlight:#549463}}:root.dark .shiki-light,:root:not(.dark) .shiki-dark{display:none}html,body{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}body{background-color:var(--background,white);color:var(--text-color,black);flex-direction:column;min-height:100vh;display:flex}header{background-color:var(--muted-background-opaque,white);justify-content:space-around;align-items:center;padding:14px;font-size:16px;display:flex}:root:not(.dark) header{border-bottom:2px solid var(--border)}header>div{justify-content:space-between;align-items:center;display:flex;width:100%!important}header video{position:absolute}header h1{color:var(--text-color);font-size:20px;font-weight:100}header h1>a{color:var(--text-color)!important}header .icon-title{align-items:center;gap:8px;display:flex}header img{width:auto;height:26px;position:relative;top:-4px}@media print{header nav,footer{display:none}}header nav>ul{padding-left:0;list-style:none;display:flex}header nav>ul>li{text-transform:lowercase;margin-left:10px}h1,h2,h3,h4,h5{scroll-margin:100px;font-family:Be Vietnam Pro,sans-serif;font-weight:600}::selection{background:var(--muted-accent);color:var(--background)}em{position:relative;left:-2px}ul,ol{margin:0;padding-left:20px}hr{border:none;border-top:1px solid var(--text-color);width:100%;margin:30px auto}main{margin:20px 0 80px}.width-box{width:95%;margin:0 auto}svg.icon{fill:var(--muted-accent);height:10pt;position:relative;top:2px}a{color:var(--accent,white);text-decoration:none}a:visited{color:var(--muted-accent,white)}pre code{tab-size:4;overflow-x:hidden;white-space:break-spaces!important}:is(div,p,a,li)>code,div>pre{border-radius:4px;font-size:15px}pre,code{font-family:JetBrains Mono,Fira Code light,consolas,monospace;background-color:var(--muted-background)!important}footer{background-color:var(--muted-background,white);margin-top:auto;padding:22px}:root:not(.dark) footer{border-top:2px solid var(--border)}footer>div{justify-content:space-between;align-items:center;display:flex}footer h3{font-weight:inherit;margin:0;font-size:16px}footer nav ul{flex-wrap:wrap;gap:6px;list-style:none;display:flex}footer nav ul>li:not(:first-child){border-left:2px solid var(--muted-accent);padding-left:6px}footer>div>:nth-child(2n){margin-left:auto;font-size:10pt}@media screen and (width<=480px){header>div{flex-direction:column}body{box-sizing:border-box;width:100vw}.posts>ul>li img{width:100%;height:auto}}@media screen and (width>=480px){@supports (backdrop-filter:blur(20px)){header{backdrop-filter:blur(20px)}}header{z-index:100;position:sticky;top:0;left:0;right:0}.width-box{width:100%;max-width:min(80vw,780px)}}</style>
</head>

<body>
    <header>
        <div class="width-box">
            <a href="/" class="icon-title">
                <h1 class="header-title">Ben's Engineering Blog</h1>
                <img alt decoding="async" height="256" src="/media/icon.png.webp" width="256" fetchpriority="high" draggable="true">
                
            </a>
            <nav>
                <ul>
                    <li><a href="/posts">Posts</a></li>
                    <li><a href="/about">About</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <main>
        
        <div class="width-box">
            <style>.post{flex-direction:column;display:flex}.post>p,.post li,.post blockquote{line-height:1.6em;font-weight:inherit;margin:6px 0;font-family:Inter,Helvetica,sans-serif}.post>:is(h1,h2,h3,h4,h5){margin:12pt 0}.post img,.post video,.post pre:not(.shiki){margin:20px 0}.post pre.shiki{margin:0}:root:not(.dark) .post img.invertible,:root:not(.dark) .post video.invertible{filter:invert()}.post img{border-radius:10px}.post svg.icon{fill:var(--text-color);height:1em}.post span.line.highlight{background-color:var(--code-highlight);outline:4px var(--code-highlight)solid;font-weight:700}.post .shiki-container{padding:20px}.post .math{margin:auto}.post .math>svg{width:auto;height:200%;margin:10px}.post .quote{font-style:italic}.post .quote:before,.post .quote:after{content:"\""}.post [role=caption]{text-align:center;opacity:.8;margin:6px 0 20px;padding:6px;font-size:14px;font-weight:400}.post .date{margin-top:0;font-family:monospace;font-size:11pt}.post .center{text-align:center;font-weight:inherit;padding:30px}.post .note{opacity:.8;font-size:12pt;font-style:italic}:is(h1,h2,h3,h4,h5,h6)>code{font-size:.8em}:is(h1,h2,h3,h4,h5,h6,p,li)>code{padding:2px 6px}.post a[href^=\#foot]{font-family:monospace;position:relative;top:-5px;left:2px}.post #footnotes~*{width:100%;margin:4px 0;font-size:14px}video.small{max-height:300px!important}.callout{background-color:var(--muted-background);border:3px solid var(--muted-accent);border-radius:16px;margin-top:18px;padding:20px;font-size:15pt}.post h1.title{font-size:48px}.post h1{font-size:32px}.post h2{font-size:28px}.post h3{font-size:24px}.post h4{font-size:20px}.post h5{font-size:16px}.post a.media-container>img{width:100%}blockquote{border-left:4px solid var(--muted-accent);margin:10px 0;padding:0 10px}blockquote>p{margin:0}.discussions{margin:80px 0}.parralel pre:not(.shiki){font-size:12px}@media screen and (width<=480px){.center{text-align:center;font-weight:inherit;padding:10px 0}.post>p,.post li{font-size:12pt;line-height:1.4em}.post img,.post pre,.post video{width:100%;height:auto}.post pre{overflow-x:auto}}@media screen and (width>=480px){.post>.parralel{gap:30px;display:flex}.post>.parralel>div{flex-grow:1}.post img,.post video,.post pre:not(.shiki){align-self:center;max-width:100vw;height:auto;max-height:100vh}.post>img,.post>video,.post>a.media-container,.post>.parralel,.post>pre:not(.shiki){align-self:center;width:110%}}@media print{.post video{display:none}}</style>

<div class="post">
    <h1 class="title">Ezno in '23</h1>
    
    <p class="date">
        Published on Wednesday 18<sup>th</sup> January 2023
        
    </p>
    
    <p>It's been a minute since the previous announcement so I thought would give some updates and share some upcoming problems. This follows the initial announcement and includes some smaller things I <a href="https://twitter.com/kaleidawave">shared on Twitter</a> since the announcement post.</p>
<p>Never heard of Ezno? It is a parser, partial executor, optimizer and type checker for JavaScript! <a href="/posts/introducing-ezno">Read the initial announcement</a>.</p>
<h2 id="new-changes" tabindex="-1">New changes</h2>
<h3 id="classes%2C-getters-and-setters" tabindex="-1">Classes, getters and setters</h3>
<p>I added support for classes, getters and setters</p>
<img alt="Handling of classes" decoding="async" height="892" src="../../media/ezno-screenshots/class-01.png.jpg" width="773" class="invertible" fetchpriority="high">
<p>This required some changes to the definition of types and how they handle prototypes. I also added handling for the cases when a property is a getter or setter when doing property access and assignments. This addition also added support for getters and setters in object literals.</p>
<h4 id="tree-shaking-methods" tabindex="-1">Tree shaking methods</h4>
<p>When adding classes I extended the tree-shaking mechanism (present but not mentioned in the announcement post) to class methods. Because of object tracing and call detection, if a method on a class is never called then the code is never included in the output.</p>
<p><img alt="Input" decoding="async" height="668" src="/media/ezno-screenshots/class-tree-shaking-01.png.webp" width="697" class="invertible" loading="lazy">
<img alt="Output" decoding="async" height="562" src="/media/ezno-screenshots/class-tree-shaking-02.png.webp" width="975" class="invertible" loading="lazy"></p>
<p>This is one of the reasons for not following TypeScript's rules around <code>any</code>. If even a single call like <code>(x as any)["method" as any]()</code> was treated with type annotations being the source of truth then any sort of method removal could remove called code.</p>
<p><strong>The perhaps underrated benefit here it is not just class code being removed, it is all functions that might be referenced in a class method that can now be removed.</strong></p>
<h4 id="custom-element-registration-event" tabindex="-1">Custom element registration event</h4>
<img alt="Output" decoding="async" height="572" src="/media/ezno-screenshots/class-custom-elements.png.webp" width="1028" class="invertible" loading="lazy">
<p>Putting aside any of my opinions on custom elements. Calling <a href="https://developer.mozilla.org/en-US/docs/Web/API/CustomElementRegistry/define"><code>CustomElementRegistry.define()</code></a> results in running an effect that adds a mapping to the <a href="https://github.com/microsoft/TypeScript/blob/9c9d4b029d71fc6b56598b0ff201c2a271c31c06/lib/lib.dom.d.ts#L17630"><code>HTMLElementTagNameMap</code></a> type and thus can get type safety in some more tricky scenarios.</p>
<h3 id="a-repl" tabindex="-1">A REPL</h3>
<p>A REPL (read evaluate print loop) is an interactive code executor. Similar to <a href="https://www.npmjs.com/package/ts-node">ts-node</a>, the Ezno REPL wraps an existing REPL with a checker. This required a few changes and while still a long way from perfect the checker can do a little more incrementally.</p>
<img alt="REPL in eval mode" decoding="async" height="919" src="/media/ezno-screenshots/repl-01.png.webp" width="1075" class="invertible" loading="lazy">
<p>There is also a mode that prints the type output.</p>
<img alt="REPL in type mode" decoding="async" height="460" src="/media/ezno-screenshots/repl-02.png.webp" width="847" class="invertible" loading="lazy">
<p>This is mostly to help me with debugging what Ezno does. But maybe it will be useful generally for working out the arguments for functions etc.</p>
<p>You can see the <a href="https://gist.github.com/kaleidawave/807747b31458bad6540da976529c4d3d">wrapper code for Deno here</a>.</p>
<h4 id="the-satisfies-operator" tabindex="-1">The <code>satisfies</code> operator</h4>
<p>There are two interesting things I slipped into the first code snippet that ran in the REPL.</p>
<p><em>The first was a divides operator. I was just playing around, it won't be in the published tool. 😀</em></p>
<p>The second one is revealed if you try <a href="https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgCoE9kG9kAcoD2uAXMgM5hSgDmyAPsiAK4C2ARtMgL4CwAUPwQEQFZAA9SGZAF5seQiWQBmbgG5+g4aMyyAsnDAALAHS4CAdwAUY0woA0yAEwBKZAGpkADlVA">running the code in TSC</a>.</p>
<hr>
<p>I was recently asked whether Ezno supported the recent TypeScript addition, the <code>satisfies</code> operator. The <code>satisfies</code> binary operator is a compile-time assertion that the left expression operand is typeable under the right type reference operand. It has almost identical behaviour to the <code>assertType</code> identity function trick that was shown in the original announcement.</p>
<p>The existence of this piece of syntax seems to be handling a problem that occurs with variable declarations in TypeScript. With the statement <code>let x: A = b</code>, variable reference <code>x</code> is considered to have all the properties of type <code>A</code>. While that is fine and how every nominal type system works, it can cause problems when <code>A</code> is a larger type than the type of <code>b</code> and loses some properties.</p>
<p>In the code shown in the REPL, TS treats <code>x.prop</code> as <code>string | number</code>. However looking at the code it is clear that the <code>x.prop</code> is a number at the point of the <code>Math.pow</code> call, never a <code>string</code>. What <code>satisfies</code> allows for is checking without <em>widening</em> the type (as widening loses information).</p>
<p>So how does this check under Ezno? Although <code>Math.pow</code> can take a string argument in JS, it is typed as <code>(a: number, b: number) =&gt; number;</code>. So it has approved <code>x.prop</code> as a number.</p>
<p>In Ezno variables have two pieces of type data attached to them:</p>
<ol>
<li>A <em>current</em> value</li>
<li>A space the value can operate in (defined using the variable type annotation)</li>
</ol>
<p><strong>The current value type is used when checking usage and the space type is used when checking reassignments.</strong></p>
<img alt="reassignments" decoding="async" height="1036" src="/media/ezno-screenshots/reassignment-diagram.png.webp" width="1200" class="invertible" loading="lazy">
<p>Therefore the <code>Math.pow</code> call checks <code>x</code> using the current value (which is a number here). It does not use the reassignment constraint.</p>
<p>This was present early in Ezno (before I had heard of the <code>satisfies</code> operator). This behaviour was needed to be able to detect dead code here:</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">let</span><span style="color:#c9d1d9"> x</span><span style="color:#ff7b72">:</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">number</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">2</span><span style="color:#c9d1d9">;</span></span>
<span class="line"><span style="color:#ff7b72">if</span><span style="color:#c9d1d9"> (x </span><span style="color:#ff7b72">!==</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">2</span><span style="color:#c9d1d9">) {</span></span>
<span class="line"><span style="color:#c9d1d9">	</span><span style="color:#d2a8ff">bigFunction</span><span style="color:#c9d1d9">()</span></span>
<span class="line"><span style="color:#c9d1d9">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">let</span><span style="color:#24292f"> x</span><span style="color:#cf222e">:</span><span style="color:#24292f"> </span><span style="color:#0550ae">number</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">2</span><span style="color:#24292f">;</span></span>
<span class="line"><span style="color:#cf222e">if</span><span style="color:#24292f"> (x </span><span style="color:#cf222e">!==</span><span style="color:#24292f"> </span><span style="color:#0550ae">2</span><span style="color:#24292f">) {</span></span>
<span class="line"><span style="color:#24292f">	</span><span style="color:#8250df">bigFunction</span><span style="color:#24292f">()</span></span>
<span class="line"><span style="color:#24292f">}</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>The problem I have with satisfies is that isn't a drop in replacement. There doesn't seem to be a way to retain the value information while constraining variable value for reassignment. That is something that is the default with Ezno's point-in-a-space system.</p>
<hr>
<p>I am glad that TypeScript is pursuing more into dependent/literal types checking. And I can see why variable declarations are checked that way in TSC. Ezno's implementation only works because of effect tracking, which allows it to identify variable mutations from functions. Effect tracking is tricky to do (as will be shown later), so I understand why TypeScript doesn't do it.</p>
<p>So <code>satisfies</code> doesn't have any effect on checking in Ezno. Similarly things like <code>as const</code> don't help Ezno. They don't have any effect on the system as it is all inferred or treated computationally.</p>
<p>Is there a limit to how much TypeScript can tighten up by adding additional syntax? Does Ezno's effect tracking make it more approachable for beginners?</p>
<h3 id="binary-context%2Fdefinition-files" tabindex="-1">Binary context/definition files</h3>
<p>I added a binary serialized form of contexts just before the announcement went up but didn't have a lot of space to include it. These are an alternative form to <code>.d.ts</code> files and are more compact and include direct references to the identifiers used in Ezno.</p>
<img alt="Hex dump of binary" decoding="async" height="678" src="/media/ezno-screenshots/binary-context-01.png.webp" width="921" class="invertible" loading="lazy">
<p>In TSC cold start time is not great. One of the bottlenecks (I think) for performance, is the parsing and synthesizing initial contexts stage. Definition files are large, contain lots of unused information in terms of comments (only useful when using TSC in LSP mode) and are a format that is intensive to parse. On the other hand, Ezno's additional low-level byte definition files (that can be generated from an existing context) can be synthesized without having to build up an abstract syntax tree and are much smaller with no whitespace and extracted comments. The format is split up the same way the data structures are arranged in the checker. Regular definition files are dense with information, the binary form has sections for type name mapping, variable mapping, function types, etc which could be processed in parallel for further improvement.</p>
<p>These results are only for <code>simple.d.ts</code> which is a subset of the declarations in <code>lib.d.ts</code>. It's about 6x times smaller as it only includes the definitions that Ezno currently understands. However, the benefits are looking promising at around ~14x faster creating initial contexts:</p>
<pre><code class="language-shell"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#c9d1d9">Parsing .d.ts: 4.4306ms</span></span>
<span class="line"><span style="color:#c9d1d9">Synthesizing .d.ts: 10.4137ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c9d1d9">Reading from binary 988.5μs</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#24292f">Parsing .d.ts: 4.4306ms</span></span>
<span class="line"><span style="color:#24292f">Synthesizing .d.ts: 10.4137ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292f">Reading from binary 988.5μs</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>One of the benefits of being written in Rust <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Rust icon</title><path d="M23.8346 11.7033l-1.0073-.6236a13.7268 13.7268 0 00-.0283-.2936l.8656-.8069a.3483.3483 0 00-.1154-.578l-1.1066-.414a8.4958 8.4958 0 00-.087-.2856l.6904-.9587a.3462.3462 0 00-.2257-.5446l-1.1663-.1894a9.3574 9.3574 0 00-.1407-.2622l.49-1.0761a.3437.3437 0 00-.0274-.3361.3486.3486 0 00-.3006-.154l-1.1845.0416a6.7444 6.7444 0 00-.1873-.2268l.2723-1.153a.3472.3472 0 00-.417-.4172l-1.1532.2724a14.0183 14.0183 0 00-.2278-.1873l.0415-1.1845a.3442.3442 0 00-.49-.328l-1.076.491c-.0872-.0476-.1742-.0952-.2623-.1407l-.1903-1.1673A.3483.3483 0 0016.256.955l-.9597.6905a8.4867 8.4867 0 00-.2855-.086l-.414-1.1066a.3483.3483 0 00-.5781-.1154l-.8069.8666a9.2936 9.2936 0 00-.2936-.0284L12.2946.1683a.3462.3462 0 00-.5892 0l-.6236 1.0073a13.7383 13.7383 0 00-.2936.0284L9.9803.3374a.3462.3462 0 00-.578.1154l-.4141 1.1065c-.0962.0274-.1903.0567-.2855.086L7.744.955a.3483.3483 0 00-.5447.2258L7.009 2.348a9.3574 9.3574 0 00-.2622.1407l-1.0762-.491a.3462.3462 0 00-.49.328l.0416 1.1845a7.9826 7.9826 0 00-.2278.1873L3.8413 3.425a.3472.3472 0 00-.4171.4171l.2713 1.1531c-.0628.075-.1255.1509-.1863.2268l-1.1845-.0415a.3462.3462 0 00-.328.49l.491 1.0761a9.167 9.167 0 00-.1407.2622l-1.1662.1894a.3483.3483 0 00-.2258.5446l.6904.9587a13.303 13.303 0 00-.087.2855l-1.1065.414a.3483.3483 0 00-.1155.5781l.8656.807a9.2936 9.2936 0 00-.0283.2935l-1.0073.6236a.3442.3442 0 000 .5892l1.0073.6236c.008.0982.0182.1964.0283.2936l-.8656.8079a.3462.3462 0 00.1155.578l1.1065.4141c.0273.0962.0567.1914.087.2855l-.6904.9587a.3452.3452 0 00.2268.5447l1.1662.1893c.0456.088.0922.1751.1408.2622l-.491 1.0762a.3462.3462 0 00.328.49l1.1834-.0415c.0618.0769.1235.1528.1873.2277l-.2713 1.1541a.3462.3462 0 00.4171.4161l1.153-.2713c.075.0638.151.1255.2279.1863l-.0415 1.1845a.3442.3442 0 00.49.327l1.0761-.49c.087.0486.1741.0951.2622.1407l.1903 1.1662a.3483.3483 0 00.5447.2268l.9587-.6904a9.299 9.299 0 00.2855.087l.414 1.1066a.3452.3452 0 00.5781.1154l.8079-.8656c.0972.0111.1954.0203.2936.0294l.6236 1.0073a.3472.3472 0 00.5892 0l.6236-1.0073c.0982-.0091.1964-.0183.2936-.0294l.8069.8656a.3483.3483 0 00.578-.1154l.4141-1.1066a8.4626 8.4626 0 00.2855-.087l.9587.6904a.3452.3452 0 00.5447-.2268l.1903-1.1662c.088-.0456.1751-.0931.2622-.1407l1.0762.49a.3472.3472 0 00.49-.327l-.0415-1.1845a6.7267 6.7267 0 00.2267-.1863l1.1531.2713a.3472.3472 0 00.4171-.416l-.2713-1.1542c.0628-.0749.1255-.1508.1863-.2278l1.1845.0415a.3442.3442 0 00.328-.49l-.49-1.076c.0475-.0872.0951-.1742.1407-.2623l1.1662-.1893a.3483.3483 0 00.2258-.5447l-.6904-.9587.087-.2855 1.1066-.414a.3462.3462 0 00.1154-.5781l-.8656-.8079c.0101-.0972.0202-.1954.0283-.2936l1.0073-.6236a.3442.3442 0 000-.5892zm-6.7413 8.3551a.7138.7138 0 01.2986-1.396.714.714 0 11-.2997 1.396zm-.3422-2.3142a.649.649 0 00-.7715.5l-.3573 1.6685c-1.1035.501-2.3285.7795-3.6193.7795a8.7368 8.7368 0 01-3.6951-.814l-.3574-1.6684a.648.648 0 00-.7714-.499l-1.473.3158a8.7216 8.7216 0 01-.7613-.898h7.1676c.081 0 .1356-.0141.1356-.088v-2.536c0-.074-.0536-.0881-.1356-.0881h-2.0966v-1.6077h2.2677c.2065 0 1.1065.0587 1.394 1.2088.0901.3533.2875 1.5044.4232 1.8729.1346.413.6833 1.2381 1.2685 1.2381h3.5716a.7492.7492 0 00.1296-.0131 8.7874 8.7874 0 01-.8119.9526zM6.8369 20.024a.714.714 0 11-.2997-1.396.714.714 0 01.2997 1.396zM4.1177 8.9972a.7137.7137 0 11-1.304.5791.7137.7137 0 011.304-.579zm-.8352 1.9813l1.5347-.6824a.65.65 0 00.33-.8585l-.3158-.7147h1.2432v5.6025H3.5669a8.7753 8.7753 0 01-.2834-3.348zm6.7343-.5437V8.7836h2.9601c.153 0 1.0792.1772 1.0792.8697 0 .575-.7107.7815-1.2948.7815zm10.7574 1.4862c0 .2187-.008.4363-.0243.651h-.9c-.09 0-.1265.0586-.1265.1477v.413c0 .973-.5487 1.1846-1.0296 1.2382-.4576.0517-.9648-.1913-1.0275-.4717-.2704-1.5186-.7198-1.8436-1.4305-2.4034.8817-.5599 1.799-1.386 1.799-2.4915 0-1.1936-.819-1.9458-1.3769-2.3153-.7825-.5163-1.6491-.6195-1.883-.6195H5.4682a8.7651 8.7651 0 014.907-2.7699l1.0974 1.151a.648.648 0 00.9182.0213l1.227-1.1743a8.7753 8.7753 0 016.0044 4.2762l-.8403 1.8982a.652.652 0 00.33.8585l1.6178.7188c.0283.2875.0425.577.0425.8717zm-9.3006-9.5993a.7128.7128 0 11.984 1.0316.7137.7137 0 01-.984-1.0316zm8.3389 6.71a.7107.7107 0 01.9395-.3625.7137.7137 0 11-.9405.3635z"/></svg> is that dealing with low-level byte processing and access is nice and simple!</p>
<p>Still unsure how the distribution of these will work. Also currently it only supports root contexts, haven't figured source splitting and referencing for child contexts yet.</p>
<h2 id="upcoming-changes" tabindex="-1">Upcoming changes</h2>
<p>Here I some things I am going to start tackling over the next couple of months. They all relate to effects.</p>
<h3 id="internal-object-effects" tabindex="-1">Internal object effects</h3>
<p>One of the upcoming problems to solve is arrays and mutations.</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">const</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">x</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> [</span><span style="color:#79c0ff">1</span><span style="color:#c9d1d9">, </span><span style="color:#79c0ff">2</span><span style="color:#c9d1d9">, </span><span style="color:#79c0ff">3</span><span style="color:#c9d1d9">];</span></span>
<span class="line"><span style="color:#c9d1d9">x.</span><span style="color:#d2a8ff">push</span><span style="color:#c9d1d9">(</span><span style="color:#79c0ff">4</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#ff7b72">if</span><span style="color:#c9d1d9"> (x.</span><span style="color:#d2a8ff">at</span><span style="color:#c9d1d9">(</span><span style="color:#ff7b72">-</span><span style="color:#79c0ff">1</span><span style="color:#c9d1d9">) </span><span style="color:#ff7b72">!==</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">4</span><span style="color:#c9d1d9">) {</span></span>
<span class="line"><span style="color:#c9d1d9">	console.</span><span style="color:#d2a8ff">log</span><span style="color:#c9d1d9">(</span><span style="color:#a5d6ff">"Hi"</span><span style="color:#c9d1d9">)</span></span>
<span class="line"><span style="color:#c9d1d9">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">const</span><span style="color:#24292f"> </span><span style="color:#0550ae">x</span><span style="color:#24292f"> </span><span style="color:#cf222e">=</span><span style="color:#24292f"> [</span><span style="color:#0550ae">1</span><span style="color:#24292f">, </span><span style="color:#0550ae">2</span><span style="color:#24292f">, </span><span style="color:#0550ae">3</span><span style="color:#24292f">];</span></span>
<span class="line"><span style="color:#24292f">x.</span><span style="color:#8250df">push</span><span style="color:#24292f">(</span><span style="color:#0550ae">4</span><span style="color:#24292f">);</span></span>
<span class="line"><span style="color:#cf222e">if</span><span style="color:#24292f"> (x.</span><span style="color:#8250df">at</span><span style="color:#24292f">(</span><span style="color:#cf222e">-</span><span style="color:#0550ae">1</span><span style="color:#24292f">) </span><span style="color:#cf222e">!==</span><span style="color:#24292f"> </span><span style="color:#0550ae">4</span><span style="color:#24292f">) {</span></span>
<span class="line"><span style="color:#24292f">	console.</span><span style="color:#8250df">log</span><span style="color:#24292f">(</span><span style="color:#0a3069">"Hi"</span><span style="color:#24292f">)</span></span>
<span class="line"><span style="color:#24292f">}</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>Here <code>.push</code> mutates <code>x</code>. Just looking at the TS definition for the method, <code>push(...items: T[]): number</code>, it doesn't give much information about what it does. Without knowing what <code>.push</code> mutates the <code>x.get(-1)</code> call can't return accurate information. If it did know, the checker could find <code>4 !== 4</code> is always false and the if branch never fires.</p>
<p>Therefore the type declaration needs to include more information. Currently, this is done using decorators on the method declaration, which Ezno interprets specially. However, there may be a more descriptive way to register this information:</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">interface</span><span style="color:#c9d1d9"> </span><span style="color:#ffa657">Array</span><span style="color:#c9d1d9">&lt;</span><span style="color:#ffa657">T</span><span style="color:#c9d1d9">&gt; {</span></span>
<span class="line"><span style="color:#c9d1d9">	@</span><span style="color:#d2a8ff">Effects</span><span style="color:#c9d1d9">(</span></span>
<span class="line"><span style="color:#c9d1d9">		</span><span style="color:#a5d6ff">"sets [this.length] on this to T"</span><span style="color:#c9d1d9">,</span></span>
<span class="line"><span style="color:#c9d1d9">		</span><span style="color:#a5d6ff">"sets 'length' on this to Add&lt;this['length'], 1&gt;"</span></span>
<span class="line"><span style="color:#c9d1d9">	)</span></span>
<span class="line"><span style="color:#c9d1d9">	</span><span style="color:#d2a8ff">push</span><span style="color:#c9d1d9">(</span><span style="color:#ffa657">t</span><span style="color:#ff7b72">:</span><span style="color:#c9d1d9"> </span><span style="color:#ffa657">T</span><span style="color:#c9d1d9">)</span><span style="color:#ff7b72">:</span><span style="color:#c9d1d9"> </span><span style="color:#ffa657">Add</span><span style="color:#c9d1d9">&lt;</span><span style="color:#79c0ff">this</span><span style="color:#c9d1d9">[</span><span style="color:#a5d6ff">"length"</span><span style="color:#c9d1d9">], </span><span style="color:#79c0ff">1</span><span style="color:#c9d1d9">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#c9d1d9">	</span><span style="color:#8b949e">// Maybe it is more readable to do something like</span></span>
<span class="line"><span style="color:#c9d1d9">	</span><span style="color:#d2a8ff">push</span><span style="color:#c9d1d9">(</span><span style="color:#ffa657">t</span><span style="color:#ff7b72">:</span><span style="color:#c9d1d9"> </span><span style="color:#ffa657">T</span><span style="color:#c9d1d9">) performs {</span></span>
<span class="line"><span style="color:#c9d1d9">		</span><span style="color:#79c0ff">this</span><span style="color:#c9d1d9">[</span><span style="color:#79c0ff">this</span><span style="color:#c9d1d9">.</span><span style="color:#79c0ff">length</span><span style="color:#c9d1d9">] </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> t;</span></span>
<span class="line"><span style="color:#c9d1d9">		</span><span style="color:#ff7b72">return</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">++</span><span style="color:#79c0ff">this</span><span style="color:#c9d1d9">.</span><span style="color:#79c0ff">length</span><span style="color:#c9d1d9">;</span></span>
<span class="line"><span style="color:#c9d1d9">	}</span></span>
<span class="line"><span style="color:#c9d1d9">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">interface</span><span style="color:#24292f"> </span><span style="color:#953800">Array</span><span style="color:#24292f">&lt;</span><span style="color:#953800">T</span><span style="color:#24292f">&gt; {</span></span>
<span class="line"><span style="color:#24292f">	@</span><span style="color:#8250df">Effects</span><span style="color:#24292f">(</span></span>
<span class="line"><span style="color:#24292f">		</span><span style="color:#0a3069">"sets [this.length] on this to T"</span><span style="color:#24292f">,</span></span>
<span class="line"><span style="color:#24292f">		</span><span style="color:#0a3069">"sets 'length' on this to Add&lt;this['length'], 1&gt;"</span></span>
<span class="line"><span style="color:#24292f">	)</span></span>
<span class="line"><span style="color:#24292f">	</span><span style="color:#8250df">push</span><span style="color:#24292f">(</span><span style="color:#953800">t</span><span style="color:#cf222e">:</span><span style="color:#24292f"> </span><span style="color:#953800">T</span><span style="color:#24292f">)</span><span style="color:#cf222e">:</span><span style="color:#24292f"> </span><span style="color:#953800">Add</span><span style="color:#24292f">&lt;</span><span style="color:#0550ae">this</span><span style="color:#24292f">[</span><span style="color:#0a3069">"length"</span><span style="color:#24292f">], </span><span style="color:#0550ae">1</span><span style="color:#24292f">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292f">	</span><span style="color:#6e7781">// Maybe it is more readable to do something like</span></span>
<span class="line"><span style="color:#24292f">	</span><span style="color:#8250df">push</span><span style="color:#24292f">(</span><span style="color:#953800">t</span><span style="color:#cf222e">:</span><span style="color:#24292f"> </span><span style="color:#953800">T</span><span style="color:#24292f">) performs {</span></span>
<span class="line"><span style="color:#24292f">		</span><span style="color:#0550ae">this</span><span style="color:#24292f">[</span><span style="color:#0550ae">this</span><span style="color:#24292f">.</span><span style="color:#0550ae">length</span><span style="color:#24292f">] </span><span style="color:#cf222e">=</span><span style="color:#24292f"> t;</span></span>
<span class="line"><span style="color:#24292f">		</span><span style="color:#cf222e">return</span><span style="color:#24292f"> </span><span style="color:#cf222e">++</span><span style="color:#0550ae">this</span><span style="color:#24292f">.</span><span style="color:#0550ae">length</span><span style="color:#24292f">;</span></span>
<span class="line"><span style="color:#24292f">	}</span></span>
<span class="line"><span style="color:#24292f">}</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>This shouldn't be impossible to add to declarations. There isn't a huge amount in the standard library and not a huge amount in DOM API. It isn't a hugely complex task for these to be added but is very beneficial.</p>
<h3 id="asynchronous-effects" tabindex="-1">Asynchronous effects</h3>
<p>There are several different types of effects. One is modifying a variable (or property), this fixes several problems with <a href="https://github.com/microsoft/TypeScript/issues/9998">issues with control flow analysis in TypeScript</a>.</p>
<p>So far synchronous situations are covered:</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">let</span><span style="color:#c9d1d9"> x </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">2</span><span style="color:#c9d1d9">;</span></span>
<span class="line"><span style="color:#c9d1d9">(() </span><span style="color:#ff7b72">=&gt;</span><span style="color:#c9d1d9"> x</span><span style="color:#ff7b72">++</span><span style="color:#c9d1d9">)();</span></span>
<span class="line"><span style="color:#c9d1d9">assertType</span><span style="color:#ff7b72">&lt;</span><span style="color:#79c0ff">3</span><span style="color:#ff7b72">&gt;</span><span style="color:#c9d1d9">(x);</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">let</span><span style="color:#24292f"> x </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">2</span><span style="color:#24292f">;</span></span>
<span class="line"><span style="color:#24292f">(() </span><span style="color:#cf222e">=&gt;</span><span style="color:#24292f"> x</span><span style="color:#cf222e">++</span><span style="color:#24292f">)();</span></span>
<span class="line"><span style="color:#24292f">assertType</span><span style="color:#cf222e">&lt;</span><span style="color:#0550ae">3</span><span style="color:#cf222e">&gt;</span><span style="color:#24292f">(x);</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>Asynchronous code (where the order of execution isn't trivial) is next to implement:</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">let</span><span style="color:#c9d1d9"> x </span><span style="color:#ff7b72">=</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">3</span><span style="color:#c9d1d9">;</span></span>
<span class="line"><span style="color:#79c0ff">setTimeout</span><span style="color:#c9d1d9">(() </span><span style="color:#ff7b72">=&gt;</span><span style="color:#c9d1d9"> { x</span><span style="color:#ff7b72">++</span><span style="color:#c9d1d9">; }, </span><span style="color:#79c0ff">0</span><span style="color:#c9d1d9">);</span></span>
<span class="line"><span style="color:#8b949e">// Function will be called but not until it has reached a point where the event loop runs</span></span>
<span class="line"><span style="color:#c9d1d9">assertType</span><span style="color:#ff7b72">&lt;</span><span style="color:#79c0ff">3</span><span style="color:#ff7b72">&gt;</span><span style="color:#c9d1d9">(x)</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">let</span><span style="color:#24292f"> x </span><span style="color:#cf222e">=</span><span style="color:#24292f"> </span><span style="color:#0550ae">3</span><span style="color:#24292f">;</span></span>
<span class="line"><span style="color:#0550ae">setTimeout</span><span style="color:#24292f">(() </span><span style="color:#cf222e">=&gt;</span><span style="color:#24292f"> { x</span><span style="color:#cf222e">++</span><span style="color:#24292f">; }, </span><span style="color:#0550ae">0</span><span style="color:#24292f">);</span></span>
<span class="line"><span style="color:#6e7781">// Function will be called but not until it has reached a point where the event loop runs</span></span>
<span class="line"><span style="color:#24292f">assertType</span><span style="color:#cf222e">&lt;</span><span style="color:#0550ae">3</span><span style="color:#cf222e">&gt;</span><span style="color:#24292f">(x)</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>To support this, it shouldn't be too difficult:</p>
<ol>
<li>Determining when functions are queued or registered to an event loop (such as <code>setTimeout</code>, <code>addEventListener</code>) vs immediately called (such as in <code>Array.prototype.map</code>)</li>
<li>Running function effects at the end of synchronisation. Whether that is the end of the script or some <code>await</code> expressions.</li>
</ol>
<h3 id="handling-errors" tabindex="-1">Handling errors</h3>
<p>In TS, functions that throw can be typed using a return type of <code>never</code>. However, there is no information in the type system to depict what type is thrown. In Ezno <code>throw</code> statements current queue special <code>throw</code> effects. There are two things left before this system becomes usable:</p>
<ul>
<li>Expressions that always throw and are not in a catch-able structure should produce an error</li>
<li>In a try-catch statement, the checker needs to collect possible objects thrown to form a type of <code>err</code> in <code>catch (err)</code>. This makes catch branches TypeSafe™. Or alternatively, if no throw effects in the try block the checker should emit a warning.</li>
</ul>
<p>And in code that is generic:</p>
<pre><code class="language-typescript"><div class="shiki-container"><pre class="shiki shiki-dark" style="background-color:#0d1117"><code><span class="line"><span style="color:#ff7b72">function</span><span style="color:#c9d1d9"> </span><span style="color:#d2a8ff">safeEval</span><span style="color:#c9d1d9">&lt;</span><span style="color:#ffa657">T</span><span style="color:#c9d1d9"> </span><span style="color:#ff7b72">extends</span><span style="color:#c9d1d9"> () </span><span style="color:#ff7b72">=&gt;</span><span style="color:#c9d1d9"> </span><span style="color:#79c0ff">void</span><span style="color:#c9d1d9">&gt;(</span><span style="color:#ffa657">t</span><span style="color:#ff7b72">:</span><span style="color:#c9d1d9"> </span><span style="color:#ffa657">T</span><span style="color:#c9d1d9">) {</span></span>
<span class="line"><span style="color:#c9d1d9">	</span><span style="color:#ff7b72">try</span><span style="color:#c9d1d9"> {</span></span>
<span class="line"><span style="color:#c9d1d9">		</span><span style="color:#d2a8ff">t</span><span style="color:#c9d1d9">()</span></span>
<span class="line"><span style="color:#c9d1d9">	} </span><span style="color:#ff7b72">catch</span><span style="color:#c9d1d9"> (err) {</span></span>
<span class="line"><span style="color:#c9d1d9">		console.</span><span style="color:#d2a8ff">log</span><span style="color:#c9d1d9">(err.message)</span></span>
<span class="line"><span style="color:#c9d1d9">	}</span></span>
<span class="line"><span style="color:#c9d1d9">}</span></span>
<span class="line"></span></code></pre><pre class="shiki shiki-light" style="background-color:#fff"><code><span class="line"><span style="color:#cf222e">function</span><span style="color:#24292f"> </span><span style="color:#8250df">safeEval</span><span style="color:#24292f">&lt;</span><span style="color:#953800">T</span><span style="color:#24292f"> </span><span style="color:#cf222e">extends</span><span style="color:#24292f"> () </span><span style="color:#cf222e">=&gt;</span><span style="color:#24292f"> </span><span style="color:#0550ae">void</span><span style="color:#24292f">&gt;(</span><span style="color:#953800">t</span><span style="color:#cf222e">:</span><span style="color:#24292f"> </span><span style="color:#953800">T</span><span style="color:#24292f">) {</span></span>
<span class="line"><span style="color:#24292f">	</span><span style="color:#cf222e">try</span><span style="color:#24292f"> {</span></span>
<span class="line"><span style="color:#24292f">		</span><span style="color:#8250df">t</span><span style="color:#24292f">()</span></span>
<span class="line"><span style="color:#24292f">	} </span><span style="color:#cf222e">catch</span><span style="color:#24292f"> (err) {</span></span>
<span class="line"><span style="color:#24292f">		console.</span><span style="color:#8250df">log</span><span style="color:#24292f">(err.message)</span></span>
<span class="line"><span style="color:#24292f">	}</span></span>
<span class="line"><span style="color:#24292f">}</span></span>
<span class="line"></span></code></pre></div></code></pre>
<p>There needs to exist a <code>Thrown&lt;T&gt;</code> internal helper type that can extract what is thrown from a function.</p>
<h2 id="is-it-open-source%3F-where's-the-binary%3F" tabindex="-1">Is it open source? Where's the binary?</h2>
<p><a href="https://github.com/kaleidawave/ezno"><strong>UPDATE</strong>, Ezno is now open-source</a></p>
<p>Open source is more than switching a GitHub repo from private to public. IMO large public repositories should have some sort of stable roadmap or design that contributors can follow. Time needs to be put in to follow issues through. And currently, for the checker, I don't have any of that soo. I think it will be best if it is incrementally made public. The parser is nearly at a point I would consider publishable so hopefully there will be a release soon!</p>
<p>In terms of the executable binary, I want to release it when it can check an actual useful program. Once the above issues with effects are solved then, it will open up more real-world demos. After then, it should be good to go!</p>
<h3 id="other-things-coming-up" tabindex="-1">Other things coming up</h3>
<ul>
<li>I work on a few other <a href="https://crates.io/users/kaleidawave?sort=recent-updates">crates</a>. Some of those will be getting updates soon.</li>
<li>I have two posts coming out soon about Rust <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Rust icon</title><path d="M23.8346 11.7033l-1.0073-.6236a13.7268 13.7268 0 00-.0283-.2936l.8656-.8069a.3483.3483 0 00-.1154-.578l-1.1066-.414a8.4958 8.4958 0 00-.087-.2856l.6904-.9587a.3462.3462 0 00-.2257-.5446l-1.1663-.1894a9.3574 9.3574 0 00-.1407-.2622l.49-1.0761a.3437.3437 0 00-.0274-.3361.3486.3486 0 00-.3006-.154l-1.1845.0416a6.7444 6.7444 0 00-.1873-.2268l.2723-1.153a.3472.3472 0 00-.417-.4172l-1.1532.2724a14.0183 14.0183 0 00-.2278-.1873l.0415-1.1845a.3442.3442 0 00-.49-.328l-1.076.491c-.0872-.0476-.1742-.0952-.2623-.1407l-.1903-1.1673A.3483.3483 0 0016.256.955l-.9597.6905a8.4867 8.4867 0 00-.2855-.086l-.414-1.1066a.3483.3483 0 00-.5781-.1154l-.8069.8666a9.2936 9.2936 0 00-.2936-.0284L12.2946.1683a.3462.3462 0 00-.5892 0l-.6236 1.0073a13.7383 13.7383 0 00-.2936.0284L9.9803.3374a.3462.3462 0 00-.578.1154l-.4141 1.1065c-.0962.0274-.1903.0567-.2855.086L7.744.955a.3483.3483 0 00-.5447.2258L7.009 2.348a9.3574 9.3574 0 00-.2622.1407l-1.0762-.491a.3462.3462 0 00-.49.328l.0416 1.1845a7.9826 7.9826 0 00-.2278.1873L3.8413 3.425a.3472.3472 0 00-.4171.4171l.2713 1.1531c-.0628.075-.1255.1509-.1863.2268l-1.1845-.0415a.3462.3462 0 00-.328.49l.491 1.0761a9.167 9.167 0 00-.1407.2622l-1.1662.1894a.3483.3483 0 00-.2258.5446l.6904.9587a13.303 13.303 0 00-.087.2855l-1.1065.414a.3483.3483 0 00-.1155.5781l.8656.807a9.2936 9.2936 0 00-.0283.2935l-1.0073.6236a.3442.3442 0 000 .5892l1.0073.6236c.008.0982.0182.1964.0283.2936l-.8656.8079a.3462.3462 0 00.1155.578l1.1065.4141c.0273.0962.0567.1914.087.2855l-.6904.9587a.3452.3452 0 00.2268.5447l1.1662.1893c.0456.088.0922.1751.1408.2622l-.491 1.0762a.3462.3462 0 00.328.49l1.1834-.0415c.0618.0769.1235.1528.1873.2277l-.2713 1.1541a.3462.3462 0 00.4171.4161l1.153-.2713c.075.0638.151.1255.2279.1863l-.0415 1.1845a.3442.3442 0 00.49.327l1.0761-.49c.087.0486.1741.0951.2622.1407l.1903 1.1662a.3483.3483 0 00.5447.2268l.9587-.6904a9.299 9.299 0 00.2855.087l.414 1.1066a.3452.3452 0 00.5781.1154l.8079-.8656c.0972.0111.1954.0203.2936.0294l.6236 1.0073a.3472.3472 0 00.5892 0l.6236-1.0073c.0982-.0091.1964-.0183.2936-.0294l.8069.8656a.3483.3483 0 00.578-.1154l.4141-1.1066a8.4626 8.4626 0 00.2855-.087l.9587.6904a.3452.3452 0 00.5447-.2268l.1903-1.1662c.088-.0456.1751-.0931.2622-.1407l1.0762.49a.3472.3472 0 00.49-.327l-.0415-1.1845a6.7267 6.7267 0 00.2267-.1863l1.1531.2713a.3472.3472 0 00.4171-.416l-.2713-1.1542c.0628-.0749.1255-.1508.1863-.2278l1.1845.0415a.3442.3442 0 00.328-.49l-.49-1.076c.0475-.0872.0951-.1742.1407-.2623l1.1662-.1893a.3483.3483 0 00.2258-.5447l-.6904-.9587.087-.2855 1.1066-.414a.3462.3462 0 00.1154-.5781l-.8656-.8079c.0101-.0972.0202-.1954.0283-.2936l1.0073-.6236a.3442.3442 0 000-.5892zm-6.7413 8.3551a.7138.7138 0 01.2986-1.396.714.714 0 11-.2997 1.396zm-.3422-2.3142a.649.649 0 00-.7715.5l-.3573 1.6685c-1.1035.501-2.3285.7795-3.6193.7795a8.7368 8.7368 0 01-3.6951-.814l-.3574-1.6684a.648.648 0 00-.7714-.499l-1.473.3158a8.7216 8.7216 0 01-.7613-.898h7.1676c.081 0 .1356-.0141.1356-.088v-2.536c0-.074-.0536-.0881-.1356-.0881h-2.0966v-1.6077h2.2677c.2065 0 1.1065.0587 1.394 1.2088.0901.3533.2875 1.5044.4232 1.8729.1346.413.6833 1.2381 1.2685 1.2381h3.5716a.7492.7492 0 00.1296-.0131 8.7874 8.7874 0 01-.8119.9526zM6.8369 20.024a.714.714 0 11-.2997-1.396.714.714 0 01.2997 1.396zM4.1177 8.9972a.7137.7137 0 11-1.304.5791.7137.7137 0 011.304-.579zm-.8352 1.9813l1.5347-.6824a.65.65 0 00.33-.8585l-.3158-.7147h1.2432v5.6025H3.5669a8.7753 8.7753 0 01-.2834-3.348zm6.7343-.5437V8.7836h2.9601c.153 0 1.0792.1772 1.0792.8697 0 .575-.7107.7815-1.2948.7815zm10.7574 1.4862c0 .2187-.008.4363-.0243.651h-.9c-.09 0-.1265.0586-.1265.1477v.413c0 .973-.5487 1.1846-1.0296 1.2382-.4576.0517-.9648-.1913-1.0275-.4717-.2704-1.5186-.7198-1.8436-1.4305-2.4034.8817-.5599 1.799-1.386 1.799-2.4915 0-1.1936-.819-1.9458-1.3769-2.3153-.7825-.5163-1.6491-.6195-1.883-.6195H5.4682a8.7651 8.7651 0 014.907-2.7699l1.0974 1.151a.648.648 0 00.9182.0213l1.227-1.1743a8.7753 8.7753 0 016.0044 4.2762l-.8403 1.8982a.652.652 0 00.33.8585l1.6178.7188c.0283.2875.0425.577.0425.8717zm-9.3006-9.5993a.7128.7128 0 11.984 1.0316.7137.7137 0 01-.984-1.0316zm8.3389 6.71a.7107.7107 0 01.9395-.3625.7137.7137 0 11-.9405.3635z"/></svg> and procedural macros.</li>
</ul>

</div>

<div class="discussions">
    <script src="https://giscus.app/client.js" async crossorigin="anonymous" data-category="Comments" data-category-id="DIC_kwDOIy08KM4CTpn8" data-emit-metadata="0" data-input-position="bottom" data-lang="en" data-loading="lazy" data-mapping="pathname" data-reactions-enabled="1" data-repo="kaleidawave/discussions" data-repo-id="R_kgDOIy08KA" data-strict="0" data-theme="preferred_color_scheme">
            </script>
</div>

<script defer="defer">for(let video of document.querySelectorAll("video"))video.addEventListener("mouseover",e=>{e.target.play()});</script>

        </div>
        
    </main>
    <footer>
        <div class="width-box">
            <form>
                <label for="toggle-theme">Light Mode</label>
                <input id="toggle-theme" name="toggle-theme" type="checkbox">
            </form>
            <nav>
                <ul>
                    <li>
                        <a href="https://twitter.com/kaleidawave">Twitter <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Twitter icon</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a>
                    </li>
                    <li>
                        <a href="https://github.com/kaleidawave">GitHub <svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                    </li>
                    <li>
                        Built with <a href="https://www.11ty.dev/"><svg class="icon" role="img" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Eleventy icon</title><path d="M3.398 12V0h17.204v24H3.398zm13.17 6.07a1.07 1.07 0 00.373-.107c.432-.213.68-.672.877-1.626.076-.372 1.195-6.168 1.209-6.263.026-.186-.008-.382-.084-.476a.325.325 0 00-.087-.064l-.06-.031h-.291c-.253 0-.298 0-.348.02-.113.039-.207.156-.255.316-.011.038-.168.881-.348 1.873l-.328 1.802-.046-.21c-.56-2.547-.764-3.452-.794-3.532a.383.383 0 00-.103-.16c-.105-.107-.117-.11-.567-.11-.411 0-.422 0-.5.074-.086.079-.122.216-.111.42.006.115.045.27.688 2.784.663 2.587.751 2.943.787 3.177.046.3-.05.713-.208.893-.032.037-.037.039-.084.032-.028 0-.12-.027-.204-.051-.268-.078-.362-.072-.462.028-.096.096-.137.248-.138.51 0 .256.028.34.159.473.131.133.324.208.595.23.164.012.22.012.33-.001zm-1.896-1.712a.31.31 0 00.16-.192c.02-.058.022-.098.022-.356 0-.255-.003-.299-.021-.354-.04-.121-.136-.196-.278-.217-.041-.01-.2-.01-.355-.01-.365-.001-.378-.01-.446-.184-.068-.18-.096-.326-.113-.602a85.799 85.799 0 01-.012-1.94v-1.765h.35c.454 0 .507-.01.602-.113a.465.465 0 00.102-.24 3.273 3.273 0 000-.534c-.026-.16-.099-.271-.211-.322-.057-.025-.065-.026-.45-.03h-.392l-.003-1.22c-.003-1.09-.005-1.227-.021-1.278a.378.378 0 00-.201-.247c-.052-.024-.072-.025-.32-.029-.27 0-.356 0-.429.038-.087.042-.148.133-.185.278-.014.054-.032.346-.076 1.262l-.06 1.194s-.08 0-.18.01c-.206.01-.263.022-.327.086-.092.092-.12.19-.127.455-.01.334.02.487.115.588.075.081.134.1.345.106l.173.01v1.785c0 1.7.006 2.019.034 2.274.041.37.13.709.241.928.194.38.544.617.988.668h1.005l.07-.04zm-7.447 0c.098-.053.16-.154.2-.332.016-.077.018-.401.018-4.518 0-4.184-.001-4.44-.02-4.51-.05-.194-.19-.29-.378-.26-.035.01-.344.084-.686.175-.343.09-.684.18-.758.198-.17.043-.214.062-.281.126-.105.098-.122.185-.122.606 0 .416.016.5.12.604.094.095.189.1.456.03.103-.026.193-.048.2-.048.01 0 .014.784.017 3.763.003 3.436.005 3.77.021 3.84.048.202.113.296.236.34.034.013.133.016.487.014.435 0 .445 0 .49-.027zm3.203 0c.092-.046.152-.135.197-.29l.024-.084.003-4.435c.002-3.194 0-4.456-.01-4.509-.033-.2-.145-.308-.322-.308-.066 0-.198.03-.857.204-.56.147-.799.214-.849.239a.34.34 0 00-.17.184c-.024.06-.024.071-.024.479 0 .415 0 .417.026.483a.362.362 0 00.083.12c.1.1.172.105.456.034a5.46 5.46 0 01.208-.05c.008 0 .012 1.202.014 3.791l.003 3.79.026.086a.48.48 0 00.135.23c.078.062.085.063.57.06.414 0 .447 0 .487-.024z"/></svg> Eleventy</a> and
                        <a href="/architecture">others</a>
                    </li>
                </ul>
            </nav>
        </div>
    </footer>
    <script>function changeScheme(e=null){null===e&&(e="matchMedia"in window&&window.matchMedia("(prefers-color-scheme: dark)").matches),localStorage.setItem("theme",e?"dark":"light"),updateThemeClass()}function updateThemeClass(e=null){null===e&&(e="dark"===localStorage.getItem("theme")),e?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")}null===localStorage.getItem("theme")?changeScheme():updateThemeClass();{let e=document.querySelector("#toggle-theme");e.checked="dark"!==localStorage.getItem("theme"),e.addEventListener("change",e=>{changeScheme(!e.target.checked)})}document.addEventListener("click",e=>{if(e.target.matches(".post > *:is(h2, h3, h4, h5)")){let t=e.target.getAttribute("id");null!==t&&(location.href="#"+t)}});let titleBar=document.querySelector("header .icon-title");for(let element of(console.log(titleBar.querySelector("img")),titleBar.querySelector("img").addEventListener("dragend",()=>{let e=document.createElement("video"),t=document.createElement("source");t.src="/media/boom.webm",e.append(t),e.controls=!1,titleBar.appendChild(e),e.addEventListener("ended",()=>{titleBar.querySelector(".header-title").innerText="Bengineering",e.style.display="none"}),e.play()}),document.querySelectorAll("[data-highlight]"))){let e=element.getAttribute("data-highlight").split(",").map(e=>parseInt(e));for(let t of element.children[0].children)for(let l of e){let e=t.children[0].children[l],n=e.children[0],a=n.textContent.trimLeft(),r=n.textContent.length-a.length;n.childNodes[0].data=a,e.style.marginLeft=r+"ch",e.classList.add("highlight")}}</script>


</body></html>